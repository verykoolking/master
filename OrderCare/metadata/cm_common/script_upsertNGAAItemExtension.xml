<?xml version="1.0" encoding="UTF-8" ?>
<script name="cm_common.upsertNGAAItemExtension">
  <group>overridden.itemAttributeChanges</group>
  <highlight>18</highlight>
  <label>upsertNGAAItemExtension</label>
  <metaVersion>4</metaVersion>
  <parameterList>
    <parameter name="ds" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
    <parameter name="option" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    if(ds == null || ds.itemCode==null){
          return false;
    }

    //find doc
    var fnd = new Finder('cm_common.ngaaItemExtensionFinder');
    fnd.searchDocument.itemCode = ds.itemCode;
    var fndRs = fnd.search();
    var currentDoc = null;
    var key = ds.itemCode;

    if(fndRs && fndRs.length >0)
    {//ROW ALREADY EXIST
        if( fndRs.length >1)
        {//Should Return ERROR it must exist only one of it's kind
            cwt_pcmaintapi.importXlsCounting(option, "FAIL");
            cwt_pcmaintapi.storeInEventLog(option, "ERROR",  Global.translateText("CWTPC0327", null ,["NGAA CATALOG EXTENSION",key ]));
        }
        else
        {
            currentDoc = fndRs[0];
        }

    }
    else
    {//NEW ROW
        currentDoc = new Document('cm_common.cwt_ngaaItemExtension');
    }

    ds.mapStructureToDoc(currentDoc, "cm_common.ngaaItemExtensionDSToDoc");
    currentDoc.save();
    cwt_pcmaintapi.importXlsCounting(option, "SUCCESS");
    cwt_pcmaintapi.storeInEventLog(option, null,  Global.translateText("CWTPC0327", null ,["NGAA CATALOG EXTENSION",key]));

    Global.commitTransaction("CATALOG");
  ]]></script>
</script>