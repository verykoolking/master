<?xml version="1.0" encoding="UTF-8" ?>
<script name="cm_spoc.rule_CALCTInactivityStatusReadOCondRule">
  <group>rules_scripts.CyclicActions</group>
  <label>rule_CALCTInactivityStatusReadOCondRule</label>
  <metaVersion>4</metaVersion>
  <parameterList>
    <parameter name="data" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
    <parameter name="errList" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var itemFinder = new Finder("cm_spoc.catalogItemFilteredFinder");
    itemFinder.searchDocument.baseItemCode = "base_CALifeCycleTransition";
    var result = itemFinder.search();

     var s = new epc.data.Specification();
     s.project =  cwa_epc.getDefaultProj();
     var isInitial = false;
     for(var i=0; i< result.length && !isInitial; i++){
        s.specificationCode = result[i].itemCode;
        var r = epc.getSpecificationByKey(s);
        if(!api_common.isFault(r)){
            if(r.SourceStatusID == data.id && r.InitialStatus){
                isInitial = true;
            }
        }
     }
     if(data.InactivityStatus  && isInitial){
         errList.addErrorMessage(data,["InactivityStatus must be empty"],"NGAA_003","E");
     }

    return false;
  ]]></script>
</script>