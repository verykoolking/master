<?xml version="1.0" encoding="UTF-8" ?>
<script name="cm_spoc.rule_BoltOnGenSpecCondRule">
  <group>rules_scripts.BoltOnType</group>
  <label>rule_BoltOnGenSpecCondRule</label>
  <metaVersion>4</metaVersion>
  <parameterList>
    <parameter name="data" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
    <parameter name="errList" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var ret = false; //Default return value is TRUE => No Error
    var json =
          {"data" :
                [
                      {
                            "entityAttribute" : "StrictNotification" ,
                            "admissibleValues" : ["MC","GB","DT","BD","MI"]
                      },
                      {
                            "entityAttribute" : "BalanceQueryIVR" ,
                            "admissibleValues" : ["MG"]
                      },
                      {
                            "entityAttribute" : "X_NMultisession" ,
                            "admissibleValues" : ["XN"]
                      },

                      {
                            "entityAttribute" : "X_NForEvents" ,
                            "admissibleValues" : ["XN"]
                      },
                      {
                            "entityAttribute" : "GenerationOfExpirationNotice" ,
                            "admissibleValues" : ["DT","ME","MI"]
                      },
                      {
                            "entityAttribute" : "Restrictive" ,
                            "admissibleValues" : ["CR","PH"]
                      },
                      {
                            "entityAttribute" : "HighestPriorityFor100Reduction" ,
                            "admissibleValues" : ["CR"]
                      },
                      {
                            "entityAttribute" : "DynamicRating" ,
                            "admissibleValues" : ["CR"]
                      }

                ]
          };
    for (var i=0;i<json.data.length;i++) {

        var ent = json.data[i].entityAttribute;

        if (data.BoltOnGenericSpecificationDS[ent]) {
            ret = true; // If the leaf exist and is set to true we need to check that the modality value is one fo the admissible ones that's why we set ret to TRUE
            for (var k=0; k<json.data[i].admissibleValues.length; k++) {

                var val = json.data[i].admissibleValues[k];

                if(data.BoltOnTypeModality == val ) {

                    ret = false; // The Modality value is admissible for the leaf. the return value is set to false : No Error
                }


            }
        }

        if (ret) {
            errList.addErrorMessage(data,[ent,"Value Not Allowed for this modality"],"NGAA_EPC_002","E");
            ret=false;
        }

    }

    return ret;
  ]]></script>
</script>