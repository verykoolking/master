<?xml version="1.0" encoding="UTF-8" ?>
<script name="cm_spoc.synchListElements">
  <group>ui_scripts.utils</group>
  <label>synchListElements</label>
  <metaVersion>4</metaVersion>
  <parameterList>
    <parameter name="model" type="rifp"/>
    <parameter name="path" type="rifp"/>
  </parameterList>
  <script><![CDATA[
    try{
        if(cm_spoc.getExistingItem(model.specificationCode)){
            var newModel;
            var oldModel;
            var s = new epc.data.Specification();
            s.project =  cwa_epc.getDefaultProj();
            s.specificationCode = model.specificationCode;
            var r = epc.getSpecificationByKey(s);
            if(!api_common.isFault(r)){
                oldModel=r;
                oldModel = cm_spoc.initModelForModification(oldModel);
            }

            if(oldModel){
                newModel = eval("model."+path);
                oldModel = eval("oldModel."+path);

                var relsNew = newModel.List;
                var relsOld = oldModel.List;

                for(var i=0;i<relsOld.length;i++){
                    for(var j=0;j<relsNew.length;j++){
                        if(relsNew[j]==relsOld[i]) relsOld[i]=null;
                    }
                }

                for(var k=0;k<relsOld.length;k++){


                    if(relsOld[k]) cm_spoc.deleteRelatedItem(oldModel.id, relsOld[k]);
                }
            }
        }
    }
    catch(e){
        Global.logDebug("synchListElements:"+e.message);
    }
  ]]></script>
</script>