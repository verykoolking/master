<?xml version="1.0" encoding="UTF-8" ?>
<userInterface name="cm_spoc.forms.OtherOperations">
  <group>Promotion</group>
  <label>OtherOperations</label>
  <metaVersion>4</metaVersion>
  <variableList>
    <variable name="subOpRelations" type="leaf">
      <valueType>dtype_com.conceptwave.system.String</valueType>
    </variable>
    <variable name="subOpComplex" type="leaf">
      <valueType>dtype_com.conceptwave.system.Boolean</valueType>
    </variable>
    <variable name="subOpCPtype" type="leaf">
      <valueType>dtype_com.conceptwave.system.Integer</valueType>
    </variable>
    <variable name="subOpValues" type="leaf">
      <flags enum-type="metadataFlag">ARRAY</flags>
      <valueType>dtype_com.conceptwave.system.String</valueType>
    </variable>
    <variable name="SubOpType" type="leaf">
      <valueType>dtype_com.conceptwave.system.String</valueType>
    </variable>
    <variable name="subOperation" type="leaf">
      <valueType>dtype_cwt_pcdd.catalogCode</valueType>
    </variable>
    <variable name="subOpEntity" type="leaf">
      <valueType>dtype_com.conceptwave.system.Boolean</valueType>
    </variable>
    <variable name="subOpEntityLabel" type="leaf">
      <valueType>dtype_com.conceptwave.system.String</valueType>
    </variable>
    <variable name="subOpCodeTable" type="leaf">
      <valueType>dtype_com.conceptwave.system.Boolean</valueType>
    </variable>
    <variable name="subOpCodeTableLabel" type="leaf">
      <valueType>dtype_com.conceptwave.system.String</valueType>
    </variable>
    <variable name="SubOperationCode" type="leaf">
      <valueType>dtype_com.conceptwave.system.String</valueType>
    </variable>
    <variable name="subOpComplexLabel" type="leaf">
      <valueType>dtype_com.conceptwave.system.String</valueType>
    </variable>
    <variable name="SubOperationCodeValue" type="leaf">
      <valueType>dtype_com.conceptwave.system.String</valueType>
    </variable>
    <variable name="model" type="leaf">
      <flags enum-type="metadataFlag">ARRAY</flags>
      <valueType>dstruct_cm_spoc.data.OtherOperationCriterion</valueType>
    </variable>
    <variable name="Selected" type="leaf">
      <valueType>dtype_com.conceptwave.system.Boolean</valueType>
    </variable>
    <variable name="Status" type="leaf">
      <valueType>dtype_com.conceptwave.system.String</valueType>
    </variable>
    <variable name="Substatus" type="leaf">
      <valueType>dtype_com.conceptwave.system.String</valueType>
    </variable>
    <variable name="SubstatusDescription" type="leaf">
      <valueType>dtype_com.conceptwave.system.String</valueType>
    </variable>
    <variable name="isloading" type="leaf">
      <valueType>dtype_com.conceptwave.system.Boolean</valueType>
    </variable>
  </variableList>
  <vformList>
    <vform name="Forms" type="frmui">
      <extends>ui_com.conceptwave.system.UserInterface/frmui_Forms</extends>
      <overlayList>
        <overlay name="Default" type="exov">
          <base>ui_com.conceptwave.system.UserInterface/frmui_Forms/vform_Default</base>
          <extends>ui_com.conceptwave.system.UserInterface/frmui_Forms/vform_Default</extends>
          <label>Default</label>
          <overrideList>
            <override name="VerticalLayout" type="elvlt">
              <width>750px</width>
              <elementList>
                <element name="SectionStack" type="elsectnstck">
                  <visibilityMode>multiple</visibilityMode>
                  <elementList>
                    <element name="Section" type="elsect">
                      <elementList>
                        <element name="SectionHeader" type="elsecth">
                          <label>Other operations</label>
                        </element>
                        <element name="GridLayout1" type="elgrd">
                          <numOfCols>3</numOfCols>
                          <width>200px</width>
                          <elementList>
                            <element name="Operation" type="elfld">
                              <editable type="varPath">
                                <variablePathList>
                                  <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                                </variablePathList>
                              </editable>
                              <labeAlign>left</labeAlign>
                              <label>Operation</label>
                              <labelOrientation>left</labelOrientation>
                              <onChangeMethod type="varPath">
                                <variablePathList>
                                  <variablePath>ui_cm_spoc.forms.OtherOperations/uimthd_defineSubOperationsByOperation</variablePath>
                                </variablePathList>
                              </onChangeMethod>
                              <variable type="varPath">
                                <variablePathList>
                                  <variablePath>ui_cm_spoc.forms.OtherOperations/leaf_model</variablePath>
                                  <variablePath>dstruct_cm_spoc.data.NotifiableOperationRule/dstruct_Operation</variablePath>
                                </variablePathList>
                              </variable>
                            </element>
                            <element name="Button" type="elbtn">
                              <clickMethod type="varPath">
                                <variablePathList>
                                  <variablePath>ui_cm_spoc.forms.OtherOperations/usrActionMethod_FinderOperationReferenceDialog</variablePath>
                                </variablePathList>
                              </clickMethod>
                              <icon>/cwf/finder.gif</icon>
                              <width>25px</width>
                            </element>
                            <element name="MinimunNumberOfExecutions" type="elfld">
                              <labeAlign>left</labeAlign>
                              <label>Minimum number of executions</label>
                              <labelOrientation>left</labelOrientation>
                              <variable type="varPath">
                                <variablePathList>
                                  <variablePath>ui_cm_spoc.forms.OtherOperations/leaf_model</variablePath>
                                  <variablePath>dstruct_cm_spoc.data.OtherOperationCriterion/dstruct_MinimunNumberOfExecutions</variablePath>
                                </variablePathList>
                              </variable>
                            </element>
                            <element name="RowSpacer1" type="elrsp"/>
                            <element name="subOperation" type="elfld">
                              <dynLabel type="varPath">
                                <variablePathList>
                                  <variablePath>ui_cm_spoc.forms.OtherOperations/leaf_subOpEntityLabel</variablePath>
                                </variablePathList>
                              </dynLabel>
                              <editable type="varPath">
                                <variablePathList>
                                  <variablePath>ui_cm_spoc.forms.OtherOperations/permMethod_subOperationEditable</variablePath>
                                </variablePathList>
                              </editable>
                              <labeAlign>left</labeAlign>
                              <label>Suboperation</label>
                              <labelOrientation>left</labelOrientation>
                              <onChangeMethod type="varPath">
                                <variablePathList>
                                  <variablePath>ui_cm_spoc.forms.OtherOperations/uimthd_defineSubOperationsByOperation</variablePath>
                                </variablePathList>
                              </onChangeMethod>
                              <variable type="varPath">
                                <variablePathList>
                                  <variablePath>ui_cm_spoc.forms.OtherOperations/leaf_subOperation</variablePath>
                                </variablePathList>
                              </variable>
                            </element>
                            <element name="ButtonSubOp" type="elbtn">
                              <clickMethod type="varPath">
                                <variablePathList>
                                  <variablePath>ui_cm_spoc.forms.OtherOperations/usrActionMethod_FinderSubOperationReferenceDialog</variablePath>
                                </variablePathList>
                              </clickMethod>
                              <disabled type="varPath">
                                <variablePathList>
                                  <variablePath>ui_cm_spoc.forms.OtherOperations/permMethod_subOperationButtonDisabled</variablePath>
                                </variablePathList>
                              </disabled>
                              <icon>/cwf/finder.gif</icon>
                              <width>25px</width>
                            </element>
                          </elementList>
                        </element>
                        <element name="LayoutSpacer1" type="ellsp">
                          <height>60px</height>
                        </element>
                        <element name="SectionStack1" type="elsectnstck">
                          <elementList>
                            <element name="Section1" type="elsect">
                              <elementList>
                                <element name="SectionHeader1" type="elsecth">
                                  <label>Timing</label>
                                </element>
                                <element name="GridLayout" type="elgrd">
                                  <alignment>center,center</alignment>
                                  <numOfCols>4</numOfCols>
                                  <width>600px</width>
                                  <elementList>
                                    <element name="TimeIntervalType" type="elslct">
                                      <labeAlign>left</labeAlign>
                                      <label>Time Interval Type</label>
                                      <labelOrientation>left</labelOrientation>
                                      <variable type="varPath">
                                        <variablePathList>
                                          <variablePath>ui_cm_spoc.forms.OtherOperations/leaf_model</variablePath>
                                          <variablePath>dstruct_cm_spoc.data.OtherOperationCriterion/dstruct_TimeIntervalType</variablePath>
                                        </variablePathList>
                                      </variable>
                                    </element>
                                    <element name="RowSpacer" type="elrsp"/>
                                    <element name="LessThan" type="elfld">
                                      <labeAlign>left</labeAlign>
                                      <label>Less than:</label>
                                      <labelOrientation>left</labelOrientation>
                                      <variable type="varPath">
                                        <variablePathList>
                                          <variablePath>ui_cm_spoc.forms.OtherOperations/leaf_model</variablePath>
                                          <variablePath>dstruct_cm_spoc.data.OtherOperationCriterion/dstruct_LessThan</variablePath>
                                        </variablePathList>
                                      </variable>
                                    </element>
                                    <element name="Day" type="elslct">
                                      <labelOrientation>right</labelOrientation>
                                      <showLabel>false</showLabel>
                                      <variable type="varPath">
                                        <variablePathList>
                                          <variablePath>ui_cm_spoc.forms.OtherOperations/leaf_model</variablePath>
                                          <variablePath>dstruct_cm_spoc.data.OtherOperationCriterion/dstruct_Day</variablePath>
                                        </variablePathList>
                                      </variable>
                                    </element>
                                    <element name="InTheCurrent" type="elslct">
                                      <labeAlign>left</labeAlign>
                                      <label>In the current:</label>
                                      <labelOrientation>left</labelOrientation>
                                      <variable type="varPath">
                                        <variablePathList>
                                          <variablePath>ui_cm_spoc.forms.OtherOperations/leaf_model</variablePath>
                                          <variablePath>dstruct_cm_spoc.data.OtherOperationCriterion/dstruct_InTheCurrent</variablePath>
                                        </variablePathList>
                                      </variable>
                                    </element>
                                  </elementList>
                                </element>
                              </elementList>
                            </element>
                          </elementList>
                        </element>
                      </elementList>
                    </element>
                  </elementList>
                </element>
                <element name="LayoutSpacer" type="ellsp">
                  <height>30px</height>
                </element>
                <element name="VerticalLayout2" type="elvlt">
                  <elementList>
                    <element name="Separator" type="elsep">
                      <width>750px</width>
                    </element>
                    <element name="VerticalLayout1" type="elhlt">
                      <alignment>right,center</alignment>
                      <elementList>
                        <element name="OK" type="elbtn">
                          <cellAlignment>right,center</cellAlignment>
                          <clickMethod type="varPath">
                            <variablePathList>
                              <variablePath>ui_cm_spoc.forms.OtherOperations/uimthd_onClickOk</variablePath>
                            </variablePathList>
                          </clickMethod>
                          <label>Accept</label>
                        </element>
                        <element name="Cancel" type="elbtn">
                          <canSort>false</canSort>
                          <cellAlignment>center,center</cellAlignment>
                          <clickMethod type="varPath">
                            <variablePathList>
                              <variablePath>ui_cm_spoc.forms.OtherOperations/uimthd_onClickCancel</variablePath>
                            </variablePathList>
                          </clickMethod>
                          <label>Cancel</label>
                        </element>
                      </elementList>
                    </element>
                  </elementList>
                </element>
              </elementList>
            </override>
          </overrideList>
        </overlay>
      </overlayList>
    </vform>
  </vformList>
  <methodList>
    <method name="cwLeafInitAction$model" type="laction">
      <path>ui_cm_spoc.forms.OtherOperations/leaf_model</path>
      <type>initializer</type>
      <script>return cm_spoc.initOtherOperations(this);</script>
    </method>
    <method name="readOnly" type="permMethod">
      <script>return !this.model.readonly;</script>
    </method>
    <method name="FinderOperationReferenceDialog" type="usrActionMethod">
      <dialogObject>ui_com.conceptwave.system.Dialog</dialogObject>
      <showInPopup>true</showInPopup>
      <script><![CDATA[
        var newDetail = new cm_spoc.FinderSelectReference(null,this);
        newDetail.setBaseItemCode("base_Operation");
        newDetail.parentUI = this;
        return newDetail;
      ]]></script>
    </method>
    <method name="referenceCallback" type="uimthd">
      <parameterList>
        <parameter name="itemCode" type="rifp">
          <mandatory>true</mandatory>
          <type>dtype_com.conceptwave.system.String</type>
        </parameter>
        <parameter name="baseItemCode" type="rifp">
          <mandatory>true</mandatory>
          <type>dtype_com.conceptwave.system.String</type>
        </parameter>
      </parameterList>
      <script><![CDATA[
        var s = new epc.data.Specification();
        s.project =  cwa_epc.getDefaultProj();

        s.specificationCode = itemCode;
        var operation = epc.getSpecificationByKey(s);
        if(operation)
        {
            var subOperationByOperationFinder = new Finder("cm_spoc.SubOperationsByOperationScriptFinder");
            subOperationByOperationFinder.searchDocument.Operation = operation.OperationId;
            var result = subOperationByOperationFinder.search();
        }
        if(result.length>0)
        {
            this.subOperation = null;
            this.SubOperationCodeValue = null;
            cm_spoc.initSubOperation([this.model]);

            this.model.Operation = itemCode;

            if(result[0].Entity == true){
                this.subOpEntityLabel = result[0].Label;
                this.SubOpType = result[0].SubOperation;
                this.subOpEntity = true;
                this.subOpCodeTable = false;
                this.subOpComplex = false;
            }
            else{
                if(result[0].Entity == false){
                    switch(result[0].Complex){
                    case 1:
                        this.subOpEntityLabel = result[0].Label;
                        this.SubOpType = result[0].SubOperation;
                        this.SubOperationCode = result[0].SubOperationCode;
                        this.subOpRelations =  result[0].Relations;
                        this.subOpCPtype = result[0].Complex;
                        this.subOpComplex = true;
                        this.subOpCodeTable = true;
                        this.subOpEntity = false;
                        break;
                    case 2:
                        this.subOpEntityLabel = result[0].Label;
                        this.SubOpType = result[0].SubOperation;
                        this.SubOperationCode = result[0].SubOperationCode;
                        this.subOpRelations =  result[0].Relations;
                        this.subOpCPtype = result[0].Complex;
                        this.subOpComplex = true;
                        this.subOpCodeTable = true;
                        this.subOpEntity = false;
                        break;
                     default:
                        this.subOpEntityLabel = result[0].Label;
                        this.SubOpType = result[0].SubOperation;
                        this.SubOperationCode = result[0].SubOperationCode;
                        this.subOpComplex = false;
                        this.subOpCodeTable = true;
                        this.subOpEntity = false;
                    }
                }
            }
        }
        else{
            this.model.Operation = itemCode;
            this.subOperation = null;
            this.SubOperationCodeValue = null;
            this.model.SubOperation = null;
            this.model.SubOperationDS = null;
            this.subOpComplex = null;
            this.subOpCodeTable = null;
            this.subOpEntity = null;
        }
      ]]></script>
    </method>
    <method name="defineSubOperationsByOperation" type="uimthd">
      <script>return true;</script>
    </method>
    <method name="FinderLifeCycleSubStatusReferenceDialog" type="usrActionMethod">
      <dialogObject>ui_com.conceptwave.system.Dialog</dialogObject>
      <showInPopup>true</showInPopup>
      <script><![CDATA[
        var newDetail = new cm_spoc.FinderSelectReference(null,this);
        newDetail.setBaseItemCode("base_LifeCycleSubStatus");
        newDetail.modelCallback = this.setLifeCycleSubStatus;
        newDetail.parentUI = this;
        return newDetail;
      ]]></script>
    </method>
    <method name="setLifeCycleSubStatus" type="uimthd">
      <parameterList>
        <parameter name="selected" type="rifp">
          <mandatory>true</mandatory>
          <type>nmeta_com.conceptwave.system.Object</type>
        </parameter>
      </parameterList>
      <script><![CDATA[
        this.parentUI.model.LifeCycleSubStatus = selected.itemCode;

        var s = new epc.data.Specification();
        s.project =  cwa_epc.getDefaultProj();

        s.specificationCode = selected.itemCode;
        var lifeCycleSubStatus = epc.getSpecificationByKey(s);
        if(lifeCycleSubStatus)
        {
            this.parentUI.Status = lifeCycleSubStatus.Status;
            this.parentUI.Substatus = lifeCycleSubStatus.Substatus;
            this.parentUI.SubstatusDescription = lifeCycleSubStatus.DescriptionOfSubstatus;
        }
      ]]></script>
    </method>
    <method name="FinderSubOperationReferenceDialog" type="usrActionMethod">
      <dialogObject>ui_com.conceptwave.system.Dialog</dialogObject>
      <showInPopup>true</showInPopup>
      <script><![CDATA[
        if(this.subOpEntity == true)
        {
            var newDetail = new cm_spoc.FinderSelectReference(null,this);
            newDetail.setBaseItemCode('base_'+this.SubOpType);
            newDetail.modelCallback = this.setSubOperation;
            newDetail.parentUI = this;
            return newDetail;
        }
        else{
            switch(this.subOpCPtype){
            case 1:
                var entity = this.subOpRelations.split(":");
                var newDetail = new cm_spoc.FinderSelectReference(null,this);
                newDetail.setBaseItemCode('base_'+entity[0]);
                newDetail.modelCallback = this.setSubOperationCP1;
                newDetail.parentUI = this;
                return newDetail;
                break;
            case 2:
                var entity = this.subOpRelations.split(":");
                var newDetail = new cm_spoc.AttributeFinderSelectReference(null,this);
                newDetail.setBaseItemCode('base_'+entity[0]);
                newDetail.modelCallback = this.setSubOperationCP2;
                newDetail.parentUI = this;
                return newDetail;
                break;
            default:
                var newDetail = new cm_spoc.CodeTableFinderSelectReference(null,this);
                var BIC = this.SubOperationCode+"CodeTable";
                BIC = BIC.substring(0,32);
                newDetail.setBaseItemCode(BIC);
                newDetail.modelCallback = this.setSubOperationCT;
                newDetail.parentUI = this;
                return newDetail;
            }
        }
      ]]></script>
    </method>
    <method name="setSubOperation" type="uimthd">
      <parameterList>
        <parameter name="selected" type="rifp">
          <mandatory>true</mandatory>
          <type>nmeta_com.conceptwave.system.Object</type>
        </parameter>
      </parameterList>
      <script><![CDATA[
        var SubOperationTypeEnum = Global.getCTCodesAndDescriptions("SubOperationTypeCodeTable");

        var SubOperationType = null;

        for(var i=0;i<SubOperationTypeEnum.length;i=i+2)
        {
            if(SubOperationTypeEnum[i+1] == this.parentUI.SubOpType){
                var SubOperationType = SubOperationTypeEnum[i];
                break;
            }
        }
        if(SubOperationType!=null)
        {
            this.parentUI.model.SubOperationDS.SubOperationType = SubOperationType;
            this.parentUI.model.SubOperationDS.putValueByName(this.parentUI.SubOpType,selected.itemCode);
            this.parentUI.subOperation = selected.itemCode;
        }
      ]]></script>
    </method>
    <method name="setSubOperationCT" type="uimthd">
      <parameterList>
        <parameter name="selected" type="rifp">
          <mandatory>true</mandatory>
          <type>nmeta_com.conceptwave.system.Object</type>
        </parameter>
      </parameterList>
      <script><![CDATA[
        var SubOperationTypeEnum = Global.getCTCodesAndDescriptions("SubOperationTypeCodeTable");

        var SubOperationType = null;

        for(var i=0;i<SubOperationTypeEnum.length;i=i+2)
        {
            if(SubOperationTypeEnum[i+1] == this.parentUI.SubOpType){
                var SubOperationType = SubOperationTypeEnum[i];
                break;
            }
        }
        if(SubOperationType!=null)
        {
            this.parentUI.model.SubOperationDS.SubOperationType = SubOperationType;

            cm_spoc.initSubOpFromCT(this.parentUI.model.SubOperationDS,this.parentUI.SubOpType);

            this.parentUI.model.SubOperationDS.getValueByName(this.parentUI.SubOpType+"DS").putValueByName(this.parentUI.SubOperationCode,selected.itemCode);
            this.parentUI.subOperation = selected.itemCode;
        }
      ]]></script>
    </method>
    <method name="setSubOperationCP1" type="uimthd">
      <parameterList>
        <parameter name="selected" type="rifp">
          <mandatory>true</mandatory>
          <type>nmeta_com.conceptwave.system.Object</type>
        </parameter>
      </parameterList>
      <script><![CDATA[
        var SubOperationTypeEnum = Global.getCTCodesAndDescriptions("SubOperationTypeCodeTable");

        var SubOperationType = null;

        var entity = this.parentUI.subOpRelations.split(":");

        for(var i=0;i<SubOperationTypeEnum.length;i=i+2)
        {
            if(SubOperationTypeEnum[i+1] == this.parentUI.SubOpType){
                var SubOperationType = SubOperationTypeEnum[i];
                break;
            }
        }

        if(SubOperationType!=null)
        {
            this.parentUI.model.SubOperationDS.SubOperationType = SubOperationType;

            cm_spoc.initSubOpFromCT(this.parentUI.model.SubOperationDS,this.parentUI.SubOpType);

            this.parentUI.model.SubOperationDS.getValueByName(this.parentUI.SubOpType+"DS").putValueByName(entity[0],selected.itemCode);
            this.parentUI.subOperation = selected.itemCode;

            var entity0 = selected.itemCode;

            var s = new epc.data.Specification();
            s.project =  cwa_epc.getDefaultProj();

            var codeTemp = entity0;
            for(var i=0;i<entity.length-2;i++)
            {
                s.specificationCode = codeTemp;
                var c =  epc.getSpecificationByKey(s);
                if(!api_common.isFault(c)){
                    codeTemp = c.getValueByName(entity[i+1]);
                }
            }
            var values = new Array();
            if(codeTemp)
            {
                for(var i=0; i<codeTemp.length;i++)
                {
                    s.specificationCode = codeTemp[i];
                    var c =  epc.getSpecificationByKey(s);
                    if(!api_common.isFault(c)){
                        values[i] = c.getValueByName(entity[entity.length-1]);
                    }
                }
            }else{
                Global.showUserMessage("Error on the configuration of the entity selected");
            }
            this.parentUI.subOpComplexLabel = this.parentUI.SubOperationCode
            this.parentUI.subOpValues = values;
        }
      ]]></script>
    </method>
    <method name="setSubOperationCP2" type="uimthd">
      <parameterList>
        <parameter name="selected" type="rifp">
          <mandatory>true</mandatory>
          <type>nmeta_com.conceptwave.system.Object</type>
        </parameter>
      </parameterList>
      <script><![CDATA[
        var SubOperationTypeEnum = Global.getCTCodesAndDescriptions("SubOperationTypeCodeTable");

        var SubOperationType = null;
        var entity = this.parentUI.subOpRelations.split(":");
        var subAtt = this.parentUI.SubOperationCode.split(':');

        for(var i=0;i<SubOperationTypeEnum.length;i=i+2)
        {
            if(SubOperationTypeEnum[i+1] == this.parentUI.SubOpType){
                var SubOperationType = SubOperationTypeEnum[i];
                break;
            }
        }

        if(SubOperationType!=null)
        {
            this.parentUI.model.SubOperationDS.SubOperationType = SubOperationType;

            cm_spoc.initSubOpFromCT(this.parentUI.model.SubOperationDS,this.parentUI.SubOpType);
            for(var i = 0; i<subAtt.length; i++){
            this.parentUI.model.SubOperationDS.getValueByName(this.parentUI.SubOpType+"DS").putValueByName(subAtt[i],selected.getValueByName(subAtt[i]));
            }
            this.parentUI.subOperation = selected.CyclicActionSpecification;
        }
      ]]></script>
    </method>
    <method name="AttributeSelectReferenceDialog" type="usrActionMethod">
      <dialogObject>ui_com.conceptwave.system.Dialog</dialogObject>
      <showInPopup>true</showInPopup>
      <script><![CDATA[
        var newDetail = new cm_spoc.AttributeSelectReference(null,this);
        newDetail.setBaseItemCode(this.subOpValues);
        newDetail.modelCallback = this.setAttributeCP;
        newDetail.parentUI = this;
        return newDetail;
      ]]></script>
    </method>
    <method name="setAttributeCP" type="uimthd">
      <parameterList>
        <parameter name="selected" type="rifp">
          <mandatory>true</mandatory>
          <type>nmeta_com.conceptwave.system.Object</type>
        </parameter>
      </parameterList>
      <script><![CDATA[
        this.parentUI.model.SubOperationDS.getValueByName(this.parentUI.SubOpType+"DS").putValueByName(this.parentUI.SubOperationCode,selected.itemCode);
        this.parentUI.SubOperationCodeValue = selected.itemCode;
      ]]></script>
    </method>
    <method name="CodeValueEditable" type="permMethod">
      <script><![CDATA[
        if(this.subOpComplex == true && this.subOperation != null && this.subOpCPtype == 1)
            return true;
        else return false;
      ]]></script>
    </method>
    <method name="CodeValueButtonDisabled" type="permMethod">
      <script><![CDATA[
        if(this.subOpComplex == true && this.subOperation != null && this.subOpCPtype == 1)
            return false;
        else return true;
      ]]></script>
    </method>
    <method name="subOperationEditable" type="permMethod">
      <script><![CDATA[
        if(this.subOpEntity == true || this.subOpCodeTable == true || this.subOpComplex == true)
            return true;
        else return false;
      ]]></script>
    </method>
    <method name="subOperationButtonDisabled" type="permMethod">
      <script><![CDATA[
        if((this.subOpEntity == false || this.subOpEntity == null) && (this.subOpCodeTable == false
            || this.subOpCodeTable == null) && (this.subOpComplex == false || this.subOpComplex == null))
            return true;
        else return false;
      ]]></script>
    </method>
    <method name="onClickCancel" type="uimthd">
      <script>this.parent.cwDialogClose();</script>
    </method>
    <method name="onClickOk" type="uimthd">
      <script><![CDATA[
        /*this.model.PSOtherOpCriterionArrDS = cm_spoc.initInnerDS("base_TUCriterionTUOriginArr");
        var selectedItems = this.TopUpOriginPickList.selectedItems;
        for(var i=0;i<selectedItems.length;i++){
            this.model.PSOtherOpCriterionArrDS.List[i] = selectedItems[i];
        }*/
        this.model.SubOperation = this.subOperation;
        this.parent.owner.model.PSOtherOpCriterionArrDS.List[this.parent.owner.model.PSOtherOpCriterionArrDS.List.length] =  this.model;
        this.parent.owner.model.PSOtherOpCriterionArrDS.ListDS[this.parent.owner.model.PSOtherOpCriterionArrDS.ListDS.length] =  this.model;

        if(this.parent.owner.model.PSOtherOpCriterionArrDS.List.length>0){

            if(this.parent.owner.ListHistoric==null)
                this.parent.owner.ListHistoric = new DataObjectList();
            //Check if the label was added
            var exist = false;
            for(var j=0; j< this.parent.owner.ListHistoric.length; j++){
                var descArr = this.parent.owner.ListHistoric[j].description.split(' ');
                if( descArr[0] == "Operation" && this.parent.owner.ListHistoric[j].itemCode == this.model.specificationCode){
                     exist=true;
                     if(this.parent.owner.ListHistoric[j].description !=  this.model.Operation){
                          var operationName = this.model.Operation;
                          this.parent.owner.ListHistoric[j].description = "Operation "+operationName.replace("Operation","");
                     }
                }
            }
            if(!exist){
                var item = new cm_spoc.FinderSelectReferenceDS();
                var operationName = this.model.Operation;
                item.description = "Operation "+operationName.replace("Operation","");
                item.itemCode = this.model.specificationCode;
                this.parent.owner.ListHistoric.addLast(item);
                this.parent.owner.ListHistoric.updateList;
            }
        }else{
            if(this.parent.owner.ListHistoric==null)
                this.parent.owner.ListHistoric = new DataObjectList();
            for(var k=0; k< this.parent.owner.ListHistoric.length; k++){
                var descArr = this.parent.owner.ListHistoric[k].description.split(' ');
                if( descArr[0] == "Operation" &&  this.parent.owner.ListHistoric[k].itemCode)
                     this.parent.owner.ListHistoric.delete(k);
            }
            this.parent.owner.ListHistoric.updateList;
        }

        var valTIT=this.model.TimeIntervalType;
        var valLT=this.model.LessThan;
        var valITC=this.model.InTheCurrent;
        var valDay=this.model.Day;
        if (!valLT && valTIT=="R")
        {
            cm_spoc.rule_OOCLessThanMandatoryCondRule(this);
            return;
        }
        if (!valITC && valTIT=="A"){
            cm_spoc.rule_OOCInTheCurrentMandatoryCondRule(this);
            return;
        }

        if (!valDay && valTIT=="R"){
            cm_spoc.rule_OOCDayMandatoryCondRule(this);
            return;
        }

        this.parent.cwDialogClose();
      ]]></script>
    </method>
  </methodList>
</userInterface>