<?xml version="1.0" encoding="UTF-8" ?>
<userInterface name="cm_spoc.forms.ComponentUI">
  <group>Rate</group>
  <label>ComponentUI</label>
  <metaVersion>4</metaVersion>
  <variableList>
    <variable name="initialCost" type="leaf">
      <valueType>dstruct_cm_spoc.data.RatePriceEventPhase</valueType>
    </variable>
    <variable name="pulseTrainIterator" type="leaf">
      <flags enum-type="metadataFlag">ARRAY</flags>
      <valueType>ui_com.conceptwave.system.UserInterface</valueType>
    </variable>
    <variable name="model" type="leaf">
      <valueType>dstruct_cm_spoc.data.RateComponent</valueType>
    </variable>
    <variable name="pulseTrainIteratorPhase7" type="leaf">
      <flags enum-type="metadataFlag">ARRAY</flags>
      <valueType>ui_cm_spoc.forms.PulseTrainUIPhase7</valueType>
    </variable>
  </variableList>
  <vformList>
    <vform name="Forms" type="frmui">
      <extends>ui_com.conceptwave.system.UserInterface/frmui_Forms</extends>
      <overlayList>
        <overlay name="Default" type="exov">
          <base>ui_com.conceptwave.system.UserInterface/frmui_Forms/vform_Default</base>
          <extends>ui_com.conceptwave.system.UserInterface/frmui_Forms/vform_Default</extends>
          <label>Default</label>
          <overrideList>
            <override name="GridLayout" type="elvlt">
              <width>750px</width>
              <elementList>
                <element name="Layout" type="elvlt">
                  <elementList>
                    <element name="Layout1" type="elvlt">
                      <elementList>
                        <element name="StartDate" type="eldatetime">
                          <autoFocusNextField>false</autoFocusNextField>
                          <endYear>2020</endYear>
                          <label>Start date of validity</label>
                          <labelOrientation>left</labelOrientation>
                          <variable type="varPath">
                            <variablePathList>
                              <variablePath>ui_cm_spoc.forms.ComponentUI/leaf_model</variablePath>
                              <variablePath>dstruct_cm_spoc.data.RateComponent/dstruct_StartDate</variablePath>
                            </variablePathList>
                          </variable>
                        </element>
                        <element name="DeferredToSubscriberCycleStart" type="elchk">
                          <label>Deferred to subscriber cycle start</label>
                          <labelOrientation>right</labelOrientation>
                          <variable type="varPath">
                            <variablePathList>
                              <variablePath>ui_cm_spoc.forms.ComponentUI/leaf_model</variablePath>
                              <variablePath>dstruct_cm_spoc.data.RateComponent/dstruct_DeferredToSubscriberCycleStart</variablePath>
                            </variablePathList>
                          </variable>
                        </element>
                      </elementList>
                    </element>
                    <element name="Layout2" type="elvlt">
                      <elementList>
                        <element name="SectionStack" type="elsectnstck">
                          <visibilityMode>multiple</visibilityMode>
                          <width>750px</width>
                          <elementList>
                            <element name="Section" type="elsect">
                              <elementList>
                                <element name="InitialCost" type="elsecth">
                                  <label>Initial Cost</label>
                                </element>
                                <element name="layout2" type="elvlt">
                                  <alignment>right,center</alignment>
                                  <elementList>
                                    <element name="HorizontalLayout1" type="elhlt">
                                      <elementList>
                                        <element name="RatePriceDesc" type="elfld">
                                          <autoFocusNextField>false</autoFocusNextField>
                                          <columnSpan>3</columnSpan>
                                          <labeAlign>left</labeAlign>
                                          <label>Description</label>
                                          <labelOrientation>left</labelOrientation>
                                          <removeLabelLine>true</removeLabelLine>
                                          <variable type="varPath">
                                            <variablePathList>
                                              <variablePath>ui_cm_spoc.forms.ComponentUI/leaf_initialCost</variablePath>
                                              <variablePath>dstruct_cm_spoc.data.RatePriceEventPhase/dstruct_RatePriceDS</variablePath>
                                              <variablePath>dstruct_cm_spoc.data.RatePrice/dstruct_RatePriceDesc</variablePath>
                                            </variablePathList>
                                          </variable>
                                          <width>200px</width>
                                        </element>
                                      </elementList>
                                    </element>
                                    <element name="Layout3" type="elhlt">
                                      <elementList>
                                        <element name="Q0" type="elfld">
                                          <autoFocusNextField>false</autoFocusNextField>
                                          <cellAlignment>left,center</cellAlignment>
                                          <columnSpan>0</columnSpan>
                                          <labeAlign>right</labeAlign>
                                          <label>Call Setup</label>
                                          <labelOrientation>left</labelOrientation>
                                          <removeLabelLine>true</removeLabelLine>
                                          <variable type="varPath">
                                            <variablePathList>
                                              <variablePath>ui_cm_spoc.forms.ComponentUI/leaf_initialCost</variablePath>
                                              <variablePath>dstruct_cm_spoc.data.RatePriceEventPhase/dstruct_RatePriceDS</variablePath>
                                              <variablePath>dstruct_cm_spoc.data.RatePrice/dstruct_Q0</variablePath>
                                            </variablePathList>
                                          </variable>
                                          <width>100px</width>
                                        </element>
                                      </elementList>
                                    </element>
                                    <element name="Layout4" type="elhlt">
                                      <alignment>right,center</alignment>
                                      <elementList>
                                        <element name="Price" type="elfld">
                                          <autoFocusNextField>false</autoFocusNextField>
                                          <columnSpan>3</columnSpan>
                                          <labeAlign>right</labeAlign>
                                          <label>Cost</label>
                                          <labelOrientation>left</labelOrientation>
                                          <removeLabelLine>true</removeLabelLine>
                                          <variable type="varPath">
                                            <variablePathList>
                                              <variablePath>ui_cm_spoc.forms.ComponentUI/leaf_initialCost</variablePath>
                                              <variablePath>dstruct_cm_spoc.data.RatePriceEventPhase/dstruct_RatePriceDS</variablePath>
                                              <variablePath>dstruct_cm_spoc.data.RatePrice/dstruct_Price</variablePath>
                                            </variablePathList>
                                          </variable>
                                          <width>100px</width>
                                        </element>
                                        <element name="Denominator" type="elfld">
                                          <autoFocusNextField>false</autoFocusNextField>
                                          <columnSpan>3</columnSpan>
                                          <labeAlign>left</labeAlign>
                                          <label>/</label>
                                          <labelOrientation>left</labelOrientation>
                                          <removeLabelLine>true</removeLabelLine>
                                          <variable type="varPath">
                                            <variablePathList>
                                              <variablePath>ui_cm_spoc.forms.ComponentUI/leaf_initialCost</variablePath>
                                              <variablePath>dstruct_cm_spoc.data.RatePriceEventPhase/dstruct_RatePriceDS</variablePath>
                                              <variablePath>dstruct_cm_spoc.data.RatePrice/dstruct_Denominator</variablePath>
                                            </variablePathList>
                                          </variable>
                                          <width>70px</width>
                                        </element>
                                        <element name="CentsUnits1" type="ellab">
                                          <columnSpan>3</columnSpan>
                                          <label>cents</label>
                                          <removeLabelLine>true</removeLabelLine>
                                          <showLabel>false</showLabel>
                                          <width>70px</width>
                                        </element>
                                      </elementList>
                                    </element>
                                    <element name="Layout5" type="elhlt">
                                      <elementList>
                                        <element name="StartUnit" type="elfld">
                                          <autoFocusNextField>false</autoFocusNextField>
                                          <columnSpan>3</columnSpan>
                                          <labeAlign>right</labeAlign>
                                          <label>Charge Time</label>
                                          <labelOrientation>left</labelOrientation>
                                          <removeLabelLine>true</removeLabelLine>
                                          <variable type="varPath">
                                            <variablePathList>
                                              <variablePath>ui_cm_spoc.forms.ComponentUI/leaf_initialCost</variablePath>
                                              <variablePath>dstruct_cm_spoc.data.RatePriceEventPhase/dstruct_StartUnit</variablePath>
                                            </variablePathList>
                                          </variable>
                                          <width>100px</width>
                                        </element>
                                        <element name="LayoutSpacer3" type="ellsp">
                                          <width>20px</width>
                                        </element>
                                        <element name="MinutesSecondsEnum" type="elslct">
                                          <columnSpan>3</columnSpan>
                                          <onChangeMethod type="varPath">
                                            <variablePathList>
                                              <variablePath>ui_cm_spoc.forms.ComponentUI/uimthd_setMinuteSecond</variablePath>
                                            </variablePathList>
                                          </onChangeMethod>
                                          <removeLabelLine>true</removeLabelLine>
                                          <showLabel>false</showLabel>
                                          <variable type="varPath">
                                            <variablePathList>
                                              <variablePath>ui_cm_spoc.forms.ComponentUI/leaf_initialCost</variablePath>
                                              <variablePath>dstruct_cm_spoc.data.RatePriceEventPhase/dstruct_MinutesSecondsEnum</variablePath>
                                            </variablePathList>
                                          </variable>
                                          <width>100px</width>
                                        </element>
                                      </elementList>
                                    </element>
                                  </elementList>
                                </element>
                              </elementList>
                            </element>
                            <element name="ItemsListSection" type="elsect">
                              <removeLabelLine>true</removeLabelLine>
                              <elementList>
                                <element name="SectionHeader" type="elsecth">
                                  <label>Pulse Train Phases</label>
                                </element>
                                <element name="buttonsLayout" type="elhlt">
                                  <elementList>
                                    <element name="addButton" type="elmnu">
                                      <clickMethod type="varPath">
                                        <variablePathList>
                                          <variablePath>ui_cm_spoc.forms.ComponentUI/uimthd_addItemsList</variablePath>
                                        </variablePathList>
                                      </clickMethod>
                                      <icon>/cwt/images/16/notebook_add.png</icon>
                                      <width>40px</width>
                                    </element>
                                    <element name="deleteButton" type="elmnu">
                                      <clickMethod type="varPath">
                                        <variablePathList>
                                          <variablePath>ui_cm_spoc.forms.ComponentUI/uimthd_deleteItemsList</variablePath>
                                        </variablePathList>
                                      </clickMethod>
                                      <icon>/cwt/images/16/delete.png</icon>
                                      <width>40px</width>
                                    </element>
                                  </elementList>
                                </element>
                              </elementList>
                            </element>
                            <element name="ItemsListIterator" type="eliter">
                              <variable type="varPath">
                                <variablePathList>
                                  <variablePath>ui_cm_spoc.forms.ComponentUI/leaf_pulseTrainIterator</variablePath>
                                </variablePathList>
                              </variable>
                              <elementList>
                                <element name="ItemsListHL" type="elhlt">
                                  <width>750px</width>
                                  <elementList>
                                    <element name="ItemsListFormFrame" type="elovf">
                                      <fillSpace>false</fillSpace>
                                      <formReference type="varPath">
                                        <variablePathList>
                                          <variablePath>ui_cm_spoc.forms.ComponentUI/leaf_pulseTrainIterator</variablePath>
                                          <variablePath>ui_cm_spoc.forms.PulseTrainUI/frmui_Forms</variablePath>
                                          <variablePath>ui_cm_spoc.forms.PulseTrainUI/frmui_Forms/exov_Default</variablePath>
                                        </variablePathList>
                                      </formReference>
                                    </element>
                                  </elementList>
                                </element>
                              </elementList>
                            </element>
                          </elementList>
                        </element>
                      </elementList>
                    </element>
                  </elementList>
                </element>
              </elementList>
            </override>
          </overrideList>
        </overlay>
      </overlayList>
    </vform>
  </vformList>
  <methodList>
    <method name="setReadOnly" type="uimthd">
      <script>return;</script>
    </method>
    <method name="setMinuteSecond" type="uimthd">
      <script><![CDATA[
        if (this.initialCost.MinutesSecondsEnum == "min") {
           this.initialCost.StartUnit = this.initialCost.StartUnit/60;
        }
        else{
           this.initialCost.StartUnit = this.initialCost.StartUnit*60;
        }
      ]]></script>
    </method>
    <method name="addItemsList" type="uimthd">
      <script><![CDATA[
        var model = this.model.RCRatePriceEventPhaseArrDS.ListDS;

        if (model.length >=7) {
            Global.showUserMessage("Maximum number of Pulse Train is 6.");
            return;
        }
        else {
            if (model.length ==6){
                cm_spoc.addListElement(this, model ,"cm_spoc.forms.PulseTrainUIPhase7","base_RatePriceEventPhase","pulseTrainIterator");
            }
            else{
                cm_spoc.addListElement(this, model ,"cm_spoc.forms.PulseTrainUI","base_RatePriceEventPhase","pulseTrainIterator");
            }

            for(var i =1; i< model.length;i++) {
                  if (model[i].PhaseNumber==null) {model[i].PhaseNumber= i+1;}
                  if (model[i].PulseTrainLabel==null) {model[i].PulseTrainLabel = i;}
                  if (model[i].MinutesSecondsEnum==null) {model[i].MinutesSecondsEnum = "sec";}
                  if (model[i].PhaseNumber == 7){
                       //If the PhaseNumber is 7 all the mandatory RatePrice attributes will assume the default value for each attribute.
                        model[i].RatePriceDS.Price=0;
                        model[i].RatePriceDS.Q0=null;
                        model[i].RatePriceDS.unitOfMeasure=null;
                        model[i].RatePriceDS.Denominator=1;
                        }
            }
        }
      ]]></script>
    </method>
    <method name="deleteItemsList" type="uimthd">
      <script><![CDATA[
        //the item to delete is always the last one
        var model = this.model.RCRatePriceEventPhaseArrDS.ListDS;

            if (model.length==1){return;}//Only InitialCost is present. No PulseTrain to remove.

            for(var i =0; i< this.pulseTrainIterator.length;i++) {
                  this.pulseTrainIterator[i].Selected = false;
                  if (i==this.pulseTrainIterator.length-1){
                      this.pulseTrainIterator[i].Selected = true;
                  }
            }

        this.model.RCRatePriceEventPhaseArrDS = cm_spoc.removePulseTraintElements(this ,this.model.RCRatePriceEventPhaseArrDS,"List", "pulseTrainIterator");
      ]]></script>
    </method>
  </methodList>
</userInterface>