<?xml version="1.0" encoding="UTF-8" ?>
<script name="cm_spoc.rule_BoltOnValueOfferCondRule">
  <group>rules_scripts.BoltOn</group>
  <label>rule_BoltOnValueOfferCondRule</label>
  <metaVersion>4</metaVersion>
  <parameterList>
    <parameter name="data" type="rifp">
      <type>dstruct_cm_spoc.data.BoltOn</type>
    </parameter>
    <parameter name="errList" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    /**
     * data = cm_spoc.data.BoltOn


     if (data.BoltOnValueOfferingDS.ApplyReductionInLongDistance) {

            var itemFinder = new Finder("cwa_epc.itemAttributeFinder");
            itemFinder.searchDocument.itemCode = data.BoltOnType[0];
            itemFinder.searchDocument.attributeCode = "BoltOnTypeModality";

            var result = itemFinder.search();
            var modality;
            for(var i=0;i<result.length;i++){
                if(result[i].attributeCode == "BoltOnTypeModalityEnum"){
                   modality =  result[i].defaultValue;
                    break;
                }
            }

            if(modality && modality=="CR") {
                return false;
            } else {
               // return true;
              errList.addErrorMessage(data,["Apply Reductions in Long Distance", "Value Not Allowed for this Bolt On Type Modality"],"NGAA_EPC_002","E");
            }


     } else {
         return false;
    } */

    var mod = data.parent.BoltOnTypeModalityDesc;
    var dis = data.ApplyReductionInLongDistance;

    if ( dis == true && mod != "Reduction coefficient"){
          errList.addErrorMessage(data,["Apply Reductions in Long Distance", "Value Not Allowed for this Bolt On Type Modality"],"NGAA_EPC_002","E");
        }
    else return false;
  ]]></script>
</script>